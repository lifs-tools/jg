<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>FattyAcid.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">jgoslin-integration-tests</a> &gt; <a href="../index.html" class="el_bundle">jgoslin-parsers</a> &gt; <a href="index.source.html" class="el_package">de.isas.lipidomics.domain</a> &gt; <span class="el_source">FattyAcid.java</span></div><h1>FattyAcid.java</h1><pre class="source lang-java linenums">/*
 * 
 */
package de.isas.lipidomics.domain;

import de.isas.lipidomics.palinom.exceptions.ConstraintViolationException;
import java.util.Collections;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import java.util.TreeMap;
import java.util.stream.Collectors;
import lombok.Builder;
import lombok.Data;

/**
 * A fatty acid with a specific type. This object defines the name, position,
 * number of carbon atoms, hydroxyls and double bonds, as well as the bond type
 * to the head group. A FattyAcid can carry optional modifications and can
 * report double bond positions.
 *
 * @author nils.hoffmann
 */
<span class="nc bnc" id="L25" title="All 58 branches missed.">@Data</span>
public class FattyAcid {

<span class="fc" id="L28">    private final FattyAcidType type;</span>
<span class="fc" id="L29">    private final String name;</span>
<span class="nc" id="L30">    private final int position;</span>
<span class="fc" id="L31">    private final int nCarbon;</span>
<span class="fc" id="L32">    private final int nHydroxy;</span>
<span class="fc" id="L33">    private final int nDoubleBonds;</span>
<span class="fc" id="L34">    private final LipidFaBondType lipidFaBondType;</span>
<span class="fc" id="L35">    private final boolean lcb;</span>
<span class="fc" id="L36">    private final ModificationsList modifications;</span>
<span class="nc" id="L37">    private final Map&lt;Integer, String&gt; doubleBondPositions;</span>

    /**
     * Create a new isomeric level FattyAcid.
     *
     * @param name the name, e.g. FA1 for the first FA.
     * @param position the sn position. -1 if undefined or unknown.
     * @param nCarbon the number of carbons in this FA.
     * @param nHydroxy the number of hydroxyls on this FA.
     * @param lipidFaBondType the bond type, e.g. ESTER.
     * @param lcb true if this is a long-chain base, e.g. in a Ceramide.
     * @param modifications optional modifications for this FA.
     * @param doubleBondPositions double bond positions in this FA.
     * @see LipidFaBondType
     */
<span class="pc" id="L52">    @Builder(builderMethodName = &quot;isomericFattyAcidBuilder&quot;, builderClassName = &quot;IsomericFattyAcidBuilder&quot;)</span>
<span class="fc" id="L53">    public FattyAcid(String name, int position, int nCarbon, int nHydroxy, LipidFaBondType lipidFaBondType, boolean lcb, ModificationsList modifications, int nDoubleBonds, Map&lt;Integer, String&gt; doubleBondPositions) {</span>
<span class="fc" id="L54">        this.name = name;</span>
<span class="pc bpc" id="L55" title="1 of 2 branches missed.">        if (nCarbon &lt; 0) {</span>
<span class="nc" id="L56">            throw new ConstraintViolationException(&quot;FattyAcid must have at least 0 carbons!&quot;);</span>
        }
<span class="fc" id="L58">        this.position = position;</span>
<span class="pc bpc" id="L59" title="1 of 2 branches missed.">        if (position &lt; -1) {</span>
<span class="nc" id="L60">            throw new ConstraintViolationException(&quot;FattyAcid position must be greater or equal to -1 (undefined) or greater or equal to 0 (0 = first position)!&quot;);</span>
        }
<span class="fc" id="L62">        this.nCarbon = nCarbon;</span>
<span class="pc bpc" id="L63" title="1 of 2 branches missed.">        if (nHydroxy &lt; 0) {</span>
<span class="nc" id="L64">            throw new ConstraintViolationException(&quot;FattyAcid must have at least 0 hydroxy groups!&quot;);</span>
        }
<span class="fc" id="L66">        this.nHydroxy = nHydroxy;</span>
<span class="fc" id="L67">        this.lipidFaBondType = Optional.ofNullable(lipidFaBondType).orElse(LipidFaBondType.UNDEFINED);</span>
<span class="fc" id="L68">        this.lcb = lcb;</span>
<span class="fc bfc" id="L69" title="All 2 branches covered.">        this.modifications = modifications == null ? ModificationsList.NONE : modifications;</span>
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">        if (doubleBondPositions == null) {</span>
<span class="nc" id="L71">            this.doubleBondPositions = Collections.emptyMap();</span>
<span class="nc" id="L72">            this.nDoubleBonds = nDoubleBonds;</span>
        } else {
<span class="pc bpc" id="L74" title="1 of 2 branches missed.">            if (nDoubleBonds != doubleBondPositions.size()) {</span>
<span class="nc" id="L75">                throw new ConstraintViolationException(&quot;Isomeric FattyAcid must receive double bond positions for all double bonds! Got &quot; + nDoubleBonds + &quot; double bonds and &quot; + doubleBondPositions.size() + &quot; positions: &quot; + doubleBondPositions);</span>
            }
<span class="fc" id="L77">            this.doubleBondPositions = new TreeMap&lt;&gt;();</span>
<span class="fc" id="L78">            this.doubleBondPositions.putAll(doubleBondPositions);</span>
<span class="fc" id="L79">            this.nDoubleBonds = this.doubleBondPositions.size();</span>
        }
<span class="fc" id="L81">        this.type = FattyAcidType.ISOMERIC;</span>
<span class="fc" id="L82">    }</span>

    /**
     * Create a new structural level FattyAcid.
     *
     * @param name the name, e.g. FA1 for the first FA.
     * @param position the sn position. -1 if undefined or unknown.
     * @param nCarbon the number of carbons in this FA.
     * @param nHydroxy the number of hydroxyls on this FA.
     * @param lipidFaBondType the bond type, e.g. ESTER.
     * @param lcb true if this is a long-chain base, e.g. in a Ceramide.
     * @param modifications optional modifications for this FA.
     * @see LipidFaBondType
     */
<span class="pc" id="L96">    @Builder(builderMethodName = &quot;structuralFattyAcidBuilder&quot;, builderClassName = &quot;StructuralFattyAcidBuilder&quot;)</span>
<span class="fc" id="L97">    public FattyAcid(String name, int position, int nCarbon, int nHydroxy, int nDoubleBonds, LipidFaBondType lipidFaBondType, boolean lcb, ModificationsList modifications) {</span>
<span class="fc" id="L98">        this.name = name;</span>
<span class="pc bpc" id="L99" title="1 of 2 branches missed.">        if (nCarbon &lt; 0) {</span>
<span class="nc" id="L100">            throw new ConstraintViolationException(&quot;FattyAcid must have at least 0 carbons!&quot;);</span>
        }
<span class="fc" id="L102">        this.position = position;</span>
<span class="pc bpc" id="L103" title="1 of 2 branches missed.">        if (position &lt; -1) {</span>
<span class="nc" id="L104">            throw new ConstraintViolationException(&quot;FattyAcid position must be greater or equal to -1 (undefined) or greater or equal to 0 (0 = first position)!&quot;);</span>
        }
<span class="fc" id="L106">        this.nCarbon = nCarbon;</span>
<span class="pc bpc" id="L107" title="1 of 2 branches missed.">        if (nHydroxy &lt; 0) {</span>
<span class="nc" id="L108">            throw new ConstraintViolationException(&quot;FattyAcid must have at least 0 hydroxy groups!&quot;);</span>
        }
<span class="fc" id="L110">        this.nHydroxy = nHydroxy;</span>
<span class="pc bpc" id="L111" title="1 of 2 branches missed.">        if (nDoubleBonds &lt; 0) {</span>
<span class="nc" id="L112">            throw new ConstraintViolationException(&quot;FattyAcid must have at least 0 double bonds!&quot;);</span>
        }
<span class="fc" id="L114">        this.nDoubleBonds = nDoubleBonds;</span>
<span class="fc" id="L115">        this.lipidFaBondType = Optional.ofNullable(lipidFaBondType).orElse(LipidFaBondType.UNDEFINED);</span>
<span class="fc" id="L116">        this.lcb = lcb;</span>
<span class="fc bfc" id="L117" title="All 2 branches covered.">        this.modifications = modifications == null ? ModificationsList.NONE : modifications;</span>
<span class="fc" id="L118">        this.doubleBondPositions = Collections.emptyMap();</span>
<span class="fc" id="L119">        this.type = FattyAcidType.STRUCTURAL;</span>
<span class="fc" id="L120">    }</span>

    /**
     * Create a new molecular level FattyAcid.
     *
     * @param name the name, e.g. FA1 for the first FA.
     * @param nCarbon the number of carbons in this FA.
     * @param nHydroxy the number of hydroxyls on this FA.
     * @param lipidFaBondType the bond type, e.g. ESTER.
     * @param lcb true if this is a long-chain base, e.g. in a Ceramide.
     * @param modifications optional modifications for this FA.
     * @see LipidFaBondType
     */
<span class="pc" id="L133">    @Builder(builderMethodName = &quot;molecularFattyAcidBuilder&quot;, builderClassName = &quot;MolecularFattyAcidBuilder&quot;)</span>
<span class="fc" id="L134">    public FattyAcid(String name, int nCarbon, int nHydroxy, int nDoubleBonds, LipidFaBondType lipidFaBondType, boolean lcb, ModificationsList modifications) {</span>
<span class="fc" id="L135">        this.name = name;</span>
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">        if (nCarbon &lt; 0) {</span>
<span class="nc" id="L137">            throw new ConstraintViolationException(&quot;FattyAcid must have at least 0 carbons!&quot;);</span>
        }
<span class="fc" id="L139">        this.position = -1;</span>
<span class="pc bpc" id="L140" title="1 of 2 branches missed.">        if (position &lt; -1) {</span>
<span class="nc" id="L141">            throw new ConstraintViolationException(&quot;FattyAcid position must be greater or equal to -1 (undefined) or greater or equal to 0 (0 = first position)!&quot;);</span>
        }
<span class="fc" id="L143">        this.nCarbon = nCarbon;</span>
<span class="pc bpc" id="L144" title="1 of 2 branches missed.">        if (nHydroxy &lt; 0) {</span>
<span class="nc" id="L145">            throw new ConstraintViolationException(&quot;FattyAcid must have at least 0 hydroxy groups!&quot;);</span>
        }
<span class="fc" id="L147">        this.nHydroxy = nHydroxy;</span>
<span class="pc bpc" id="L148" title="1 of 2 branches missed.">        if (nDoubleBonds &lt; 0) {</span>
<span class="nc" id="L149">            throw new ConstraintViolationException(&quot;FattyAcid must have at least 0 double bonds!&quot;);</span>
        }
<span class="fc" id="L151">        this.nDoubleBonds = nDoubleBonds;</span>
<span class="fc" id="L152">        this.lipidFaBondType = Optional.ofNullable(lipidFaBondType).orElse(LipidFaBondType.UNDEFINED);</span>
<span class="fc" id="L153">        this.lcb = lcb;</span>
<span class="fc bfc" id="L154" title="All 2 branches covered.">        this.modifications = modifications == null ? ModificationsList.NONE : modifications;</span>
<span class="fc" id="L155">        this.doubleBondPositions = Collections.emptyMap();</span>
<span class="fc" id="L156">        this.type = FattyAcidType.MOLECULAR;</span>
<span class="fc" id="L157">    }</span>

    /**
     * Build the name of this substructure.
     *
     * @param level the structural lipid level to return this substructure's
     * name on.
     * @return the name of this substructure.
     */
    public String buildSubstructureName(LipidLevel level) {
<span class="nc" id="L167">        StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L168">        int nDB = 0;</span>
<span class="nc" id="L169">        int nHydroxy = 0;</span>
<span class="nc" id="L170">        int nCarbon = 0;</span>
<span class="nc" id="L171">        nDB += getNDoubleBonds();</span>
<span class="nc" id="L172">        StringBuilder dbPos = new StringBuilder();</span>
<span class="nc" id="L173">        List&lt;String&gt; dbPositions = new LinkedList&lt;&gt;();</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">        for (Integer key : getDoubleBondPositions().keySet()) {</span>
<span class="nc" id="L175">            dbPositions.add(key + getDoubleBondPositions().get(key));</span>
<span class="nc" id="L176">        }</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">        if (!getDoubleBondPositions().isEmpty()) {</span>
<span class="nc" id="L178">            dbPos.</span>
<span class="nc" id="L179">                    append(&quot;(&quot;).</span>
<span class="nc" id="L180">                    append(dbPositions.stream().collect(Collectors.joining(&quot;,&quot;))).</span>
<span class="nc" id="L181">                    append(&quot;)&quot;);</span>
        }

<span class="nc" id="L184">        nCarbon += getNCarbon();</span>
<span class="nc" id="L185">        nHydroxy += getNHydroxy();</span>
<span class="nc" id="L186">        sb.</span>
<span class="nc" id="L187">                append(nCarbon).</span>
<span class="nc" id="L188">                append(&quot;:&quot;).</span>
<span class="nc" id="L189">                append(nDB).</span>
<span class="nc" id="L190">                append(dbPos.toString()).</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">                append(nHydroxy &gt; 0 ? &quot;;&quot; + nHydroxy : &quot;&quot;).</span>
<span class="nc" id="L192">                append(getLipidFaBondType().suffix());</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">        if (!getModifications().isEmpty()) {</span>
<span class="nc" id="L194">            sb.append(&quot;(&quot;);</span>
<span class="nc" id="L195">            sb.append(getModifications().stream().map((t) -&gt; {</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">                return (t.getLeft() == -1 ? &quot;&quot; : t.getLeft()) + &quot;&quot; + t.getRight();</span>
<span class="nc" id="L197">            }).collect(Collectors.joining(&quot;,&quot;)));</span>
<span class="nc" id="L198">            sb.append(&quot;)&quot;);</span>
        }
<span class="nc" id="L200">        return sb.toString();</span>
    }

    public ElementTable getElements() {
<span class="fc" id="L204">        ElementTable table = new ElementTable();</span>
<span class="fc bfc" id="L205" title="All 2 branches covered.">        if (!isLcb()) {</span>
<span class="pc bpc" id="L206" title="1 of 4 branches missed.">            if (nCarbon &gt; 0 || nDoubleBonds &gt; 0) {</span>
<span class="fc" id="L207">                table.incrementBy(Element.ELEMENT_C, nCarbon);// C</span>
<span class="pc bpc" id="L208" title="1 of 4 branches missed.">                switch (lipidFaBondType) {</span>
                    case ESTER:
<span class="fc" id="L210">                        table.incrementBy(Element.ELEMENT_H, 2 * nCarbon - 1 - 2 * nDoubleBonds); // H</span>
<span class="fc" id="L211">                        table.incrementBy(Element.ELEMENT_O, 1 + nHydroxy); // O</span>
<span class="fc" id="L212">                        break;</span>
                    case ETHER_PLASMENYL:
<span class="fc" id="L214">                        table.incrementBy(Element.ELEMENT_H, 2 * nCarbon - 1 - 2 * nDoubleBonds + 2); // H</span>
<span class="fc" id="L215">                        table.incrementBy(Element.ELEMENT_O, nHydroxy); // O</span>
<span class="fc" id="L216">                        break;</span>
                    case ETHER_PLASMANYL:
<span class="fc" id="L218">                        table.incrementBy(Element.ELEMENT_H, (nCarbon + 1) * 2 - 1 - 2 * nDoubleBonds); // H</span>
<span class="fc" id="L219">                        table.incrementBy(Element.ELEMENT_O, nHydroxy); // O</span>
<span class="fc" id="L220">                        break;</span>
                    default:
<span class="nc" id="L222">                        throw new ConstraintViolationException(&quot;Mass cannot be computed for fatty acyl chain with bond type: &quot; + lipidFaBondType);</span>
                }
            }
        } else {
            // long chain base
<span class="fc" id="L227">            table.incrementBy(Element.ELEMENT_C, nCarbon); // C</span>
<span class="fc" id="L228">            table.incrementBy(Element.ELEMENT_H, 2 * (nCarbon - nDoubleBonds) + 1); // H</span>
<span class="fc" id="L229">            table.incrementBy(Element.ELEMENT_O, nHydroxy); // O</span>
<span class="fc" id="L230">            table.incrementBy(Element.ELEMENT_N, 1); // N</span>
        }
<span class="fc" id="L232">        return table;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>